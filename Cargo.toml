[package]
name = "xwing-kem"
version = "0.1.0"
edition = "2024"

[dependencies]
# ──────────────────────────────────────────────────────────────
# Core mandatory dependencies — impossible to disable securely
# ──────────────────────────────────────────────────────────────
aescrypt-rs = { path = "../../aescrypt-rs" } # AES Crypt v3 file format — this crate's entire purpose

base64 = "0.22"
blake3 = "1.8"
chrono = { version = "0.4", features = ["serde"] }
dirs = "6.0"
hex = "0.4.3"
mime_guess = "2.0"
once_cell = "1.19"
uuid = { version = "1.0", features = ["v4"] }
rand = "0.9"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
sha2 = "0.10"
argon2 = "0.5"
aes-gcm = "0.10"
tempfile = "3.23"
twox-hash = { version = "2.1", features = ["xxhash3_128", "std"] }
thiserror = "2.0"
toml = "0.9"
totp-rs = "2.0"
base32 = "0.4"
urlencoding = "2.1"

libcrux-ml-dsa = { git = "https://github.com/cryspen/libcrux", package = "libcrux-ml-dsa", branch = "main" }
libcrux-ml-kem = { git = "https://github.com/cryspen/libcrux", package = "libcrux-ml-kem", branch = "main" }
x25519-dalek = { version = "2.0", default-features = false, features = ["zeroize", "static_secrets"] }
ed25519-dalek = "2.0"

sha3 = { version = "0.10", default-features = false }
zeroize = { version = "1.8", features = ["zeroize_derive"] }
rand_core = "0.6"

# rusqlite = { version = "0.37", features = ["sqlcipher"] }
rusqlite = { version = "0.37", features = ["bundled-sqlcipher-vendored-openssl"] }

secure-gate = { path = "../../secure-gate", features = [
  "zeroize",
  "rand",
  "conversions",
] }

# ──────────────────────────────────────────────────────────────
# Optional / future CLI & logging dependencies
# ──────────────────────────────────────────────────────────────
log = { version = "0.4", optional = true }
env_logger = { version = "0.11", optional = true }
tracing = { version = "0.1", optional = true }
tracing-subscriber = { version = "0.3", features = [
  "fmt",
  "env-filter",
], optional = true }
anyhow = { version = "1.0", optional = true }
rpassword = { version = "7.4", optional = true }
walkdir = { version = "2.5", optional = true }
zip = { version = "6.0.0", optional = true, features = [
  "aes-crypto",
  "deflate",
] }
lopdf = { version = "0.38.0", optional = true }
sevenz-rust2 = { version = "0.20.0", optional = true, features = ["aes256"] }
sequoia-openpgp = { version = "1.22", optional = true, default-features = false, features = [
  "crypto-rust",
  "allow-experimental-crypto",
  "allow-variable-time-crypto",
] }
pipe = "0.4.0"

[dev-dependencies]
tempfile = "3.23"
serial_test = "3.1"
crossbeam-channel = "0.5"
criterion = { version = "0.5", features = ["html_reports"] }
rand_chacha = "0.3"

# ──────────────────────────────────────────────────────────────
# FEATURES — security-critical settings are forced on
# ──────────────────────────────────────────────────────────────
[features]
default = ["secure-gate/zeroize", "secure-gate/rand", "secure-gate/conversions"]
cli = [
  "dep:anyhow",
  "dep:rpassword",
  "dep:walkdir",
  "dep:tracing",
  "dep:tracing-subscriber",
  "dep:env_logger",
  "dep:log",
]
logging = ["dep:log", "dep:env_logger", "dep:tracing", "dep:tracing-subscriber"]
zip = ["dep:zip"]
office = ["zip"]
pdf = ["dep:lopdf"]
sevenz = ["dep:sevenz-rust2"]
gpg = ["dep:sequoia-openpgp"]
